{% extends 'base.html' %}

{% block main %}
<div class="log">
{% if event.activities %}
    {% for activity in event.activities %}
        <div class="activity">
            <h4>Activity</h4>
            <p class="description">
                {{ event.children.first_name }} {{ activity.description }} for {{ activity.duration }} minutes.
            </p>
            <p class="timestamp">
                {{ event.event_time|format_date }}
            </p>
        </div>
    {% endfor %}
{% endif %}
{% if event.sleeps %}
    {% for sleep in event.sleeps %}
        <div class="sleep">
            <h4>Sleep</h4>

            <p class="description">
                {{event.children.first_name}} went to sleep at {{ sleep.sleep_start }} and woke up at {{ sleep.sleep_end }}.
            </p>
            <p class="timestamp">
                {{ event.event_time|format_date }}
            </p>
        </div>
    {% endfor %}
{% endif %}
{% if event.foods %}
    {% for food in event.foods %}
        <div class="food">
            <h4>{{ food.meal_type | capitalize }}</h4>

            <p class="description">
                {% if event.children.gender == "m" %}
                    {{event.children.first_name}} had {{ food.description }} for his {{ food.meal_type }}.
                {% elif event.children.gender == "f" %}
                    {{event.children.first_name}} had {{ food.description }} for her {{ food.meal_type }}.
                {% else %}
                    {{event.children.first_name}} had {{ food.description }} for their {{ food.meal_type }}.
                {% endif %}

            </p>
            {% if food.picture %}
                <img src="{{ url_for('static', filename='food_pics/' + food.picture) }}" alt="Food">
            {% endif %}

            <p class="timestamp">
                {{ event.event_time|format_date }}
            </p>
        </div>
    {% endfor %}
{% endif %}
{% if event.developmentals %}
    {% for developmental in event.developmentals %}
        <div class="developmental">
            <h4>Developmental Milestone</h4>

            <p class="description">
                {{event.children.first_name}} {{developmental.description}}.
            </p>
            {% if developmental.picture %}
                <img src="{{ url_for('static', filename='event_pics/' + food.picture) }}" alt="Developmental">
            {% endif %}

            <p class="timestamp">
                {{ event.event_time|format_date }}
            </p>
        </div>
    {% endfor %}
{% endif %}
{% if event.incidents %}
    {% for incident in event.incidents %}
        <div class="incident">
            <h4>{{ incident.incident_type | capitalize }}</h4>

            <p class="description">
                {{incident.description}}
            </p>

            <p class="timestamp">
                {{ event.event_time|format_date }}
            </p>
        </div>
    {% endfor %}
{% endif %}
{% if event.medications %}
    {% for medication in event.medications %}
        <div class="medication">
            <h4>Medication</h4>

            <p class="description">
                {{ event.children.first_name }} was given {{ medication.amount }} of {{ medication.medication_name }} at {{ medication.time_given }}
                {% if medication.reason %}
                    due to {{ medication.reason }}
                {% endif %}
            </p>

            <p class="timestamp">
                {{ event.event_time|format_date }}
            </p>
        </div>
    {% endfor %}
{% endif %}
{% if event.nappies %}
    {% for nappy in event.nappies %}
        <div class="nappy">
            <h4>{{ nappy.nappy_type | capitalize }}</h4>

            <p class="description">
                {% if nappy.nappy_type == "nappy" %}
                    {{ event.children.first_name }} had a nappy change.
                {% elif nappy.nappy_type == "potty" %}
                    {{ event.children.first_name }} used the potty.
                {% endif %}
            </p>
            <br>
            <p>
                {% if nappy.condition %}
                    Additional info: {{ nappy.condition }}
                {% endif %}
            </p>

            <p class="timestamp">
                {{ event.event_time|format_date }}
            </p>
        </div>
    {% endfor %}
{% endif %}
{% if event.notes %}
    {% for note in event.notes %}
        <div class="note">
            <h4>Note</h4>

            <p class="description">
                {{  note.description }}
            </p>

            <p class="timestamp">
                {{ event.event_time|format_date }}
            </p>
        </div>
    {% endfor %}
{% endif %}
{% if event.pictures %}
{% for picture in event.pictures %}
        <div class="picture">
                <h4>Picture</h4>

                <p class="description">
                    {{  picture.caption }}
                </p>
                <img src="{{ url_for('static', filename='event_pics/' + picture.picture_file) }}" alt="Picture">

                <p class="timestamp">
                    {{ event.event_time|format_date }}
                </p>
        </div>
    {% endfor %}
{% endif %}
</div>
<div class="comments">
    {% if comments %}
        <h2>Comments</h2>
        {% for comment in comments %}
            <div class="comment">
                {% set user = User.query.get(comment.user_id) %}
                <div class="comment_profile_picture">
                    <img src="{{ url_for('static', filename='profile_pics/' + user.picture) }}" alt="Profile Picture">
                </div>
                <div class="comment_container">
                    <div class="commenter">
                        {{ user.first_name }} {{ user.last_name }} - {{ comment.comment_time|format_date}}
                    </div>
                    <div class="text">
                        {{ comment.comment_text }}
                    </div>
                    {% if user.user_id == current_user.user_id %}
                        <a href="{{ url_for('events.delete_comment', comment_id=comment.comment_id) }}">Delete</a>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    {% endif %}
</div>


<div class="form_container">
    <form class="login_form" method="POST" action="">
        <h2>Add comment</h2>
        {{ form.hidden_tag() }}
        {{ form.comment_text }}
        {{ form.submit() }}

    </form>
</div>


{% endblock %}